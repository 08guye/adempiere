<project name="Adempiere Build Travis" default="build" basedir=".">
    <description>
        Building ADempiere
        by
        Yamel Senih
        http://www.erpya.com
    </description>
  <!-- set global properties for this build -->
  <property name="env_directory" location="adempiere/Adempiere/utils"/>
  <property name="adempiere_build" location="utils_dev/build.xml"/>
  <property name="myEnvironment_CI" location="adempiere/Adempiere/utils/myEnvironment_CI.sh"/>
  <property name="myEnvironment" location="adempiere/Adempiere/utils/myEnvironment.sh"/>
  <property name="RUN_DBRestore" location="adempiere/Adempiere/utils/RUN_DBRestore.sh"/>
  <property name="RUN_ImportAdempiere" location="adempiere/Adempiere/utils/RUN_ImportAdempiere.sh"/>
  <property name="RUN_MigrateXML" location="adempiere/Adempiere/utils/RUN_MigrateXML.sh"/>
  <target name="build">
    <echo message="Building ADempiere"/>
	<ant antfile="${adempiere_build}" target="complete"/>
	
	<echo message="Deploy ADempiere"/>
	<chmod dir="${env_directory}" perm="ugo+rx" includes="**/*.sh"/>
	<chmod dir="${env_directory}/PostgreSQL" perm="ugo+rx" includes="**/*.sh"/>
	<echo message="Copy myEnvironment_CI to myEnvironment"/>
  	<copy file="${myEnvironment_CI}"
			tofile="${myEnvironment}" filtering="yes" overwrite="yes" />
  	<fail message="**** myEnvironment_CI is missing please re-run ****"" />
  	
  	<echo message="Run Import Adempiere"/>
  	<exec dir="${env_directory}" executable="/bin/bash">
    	<arg value="${RUN_ImportAdempiere}"/>
  	</exec>
  	<fail message="**** Error running RUN_ImportAdempiere.sh please re-run ****"" />
  	
  	<echo message="Run DB Restore Adempiere"/>
	<exec dir="${env_directory}" executable="/bin/bash">
    	<arg value="${RUN_DBRestore}"/>
  	</exec>
  	<fail message="**** Error running RUN_DBRestore.sh please re-run ****"" />
  	
  	<echo message="Run Migrate XML"/>
  	<chmod file="${RUN_DBRestore}" perm="ugo+rx"/>
	<exec dir="${env_directory}" executable="/bin/bash">
    	<arg value="${RUN_MigrateXML}"/>
  	</exec>
  	<fail message="**** Error running RUN_MigrateXML.sh please re-run ****"" />
  </target>
</project>
